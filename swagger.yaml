openapi: 3.0.0
info:
  title: HederaAgentsHub API
  description: Agent-first Digital Economy API using ERC-8004 on Hedera testnet
  version: 1.0.0
  contact:
    name: Nasrulhaq Khan
    email: your-email@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://your-app.up.railway.app
    description: Production server (Railway)

tags:
  - name: Health
    description: Health check endpoints
  - name: Identity
    description: Agent registration and discovery (ERC-8004)
  - name: Reputation
    description: Feedback and trust scoring (ERC-8004)
  - name: Validation
    description: Independent validations (ERC-8004)

paths:
  /:
    get:
      summary: Get API information
      tags:
        - Health
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: HederaAgentsHub API
                  version:
                    type: string
                    example: 1.0.0
                  endpoints:
                    type: object

  /health:
    get:
      summary: Health check
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                    example: '2025-11-01T06:00:00.000Z'

  /api/agent/register:
    post:
      summary: Register a new agent
      tags:
        - Identity
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentRegistration'
      responses:
        '200':
          description: Agent registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  message:
                    type: string
                    example: Agent registered successfully
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/agent/{id}:
    get:
      summary: Get agent metadata
      tags:
        - Identity
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: Agent metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  metadata:
                    $ref: '#/components/schemas/AgentMetadata'
        '404':
          description: Agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/agent/{id}/owner:
    get:
      summary: Get agent owner address
      tags:
        - Identity
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: Agent owner
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  owner:
                    type: string
                    example: '0x98d46dda75A216f94bF9784a6665A4E3821Da3D9'
        '404':
          description: Agent not found

  /api/agents/search:
    get:
      summary: Search agents by capability
      tags:
        - Identity
      parameters:
        - name: capability
          in: query
          required: true
          schema:
            type: string
          description: Capability to search for
          example: weather
      responses:
        '200':
          description: List of matching agents
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  capability:
                    type: string
                    example: weather
                  agents:
                    type: array
                    items:
                      type: string
                    example: ['agent_1', 'agent_3']
                  count:
                    type: integer
                    example: 2
        '400':
          description: Missing capability parameter

  /api/agents/count/{address}:
    get:
      summary: Get agent count for address
      tags:
        - Identity
      parameters:
        - name: address
          in: path
          required: true
          schema:
            type: string
          description: Owner address
          example: '0x98d46dda75A216f94bF9784a6665A4E3821Da3D9'
      responses:
        '200':
          description: Agent count
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  address:
                    type: string
                    example: '0x98d46dda75A216f94bF9784a6665A4E3821Da3D9'
                  count:
                    type: integer
                    example: 3

  /api/feedback:
    post:
      summary: Submit feedback for an agent
      tags:
        - Reputation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackSubmission'
      responses:
        '200':
          description: Feedback submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  feedbackId:
                    type: string
                    example: feedback_1
                  message:
                    type: string
                    example: Feedback submitted successfully
        '400':
          description: Bad request - invalid rating or missing fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/reputation/{agentId}:
    get:
      summary: Get reputation summary
      tags:
        - Reputation
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: Reputation summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  reputation:
                    $ref: '#/components/schemas/ReputationScore'
        '404':
          description: No reputation data found

  /api/reputation/{agentId}/trust:
    get:
      summary: Get trust score and trustworthiness
      tags:
        - Reputation
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: Trust score
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  trustScore:
                    type: integer
                    example: 93
                    description: Trust score (0-100)
                  trustworthy:
                    type: boolean
                    example: true

  /api/feedback/{agentId}:
    get:
      summary: Get all feedback IDs for an agent
      tags:
        - Reputation
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: List of feedback IDs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  feedbackIds:
                    type: array
                    items:
                      type: string
                    example: ['feedback_1', 'feedback_2', 'feedback_3']
                  count:
                    type: integer
                    example: 3

  /api/validation/request:
    post:
      summary: Request validation for an agent
      tags:
        - Validation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidationRequest'
      responses:
        '200':
          description: Validation requested successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  validationId:
                    type: string
                    example: validation_1
                  message:
                    type: string
                    example: Validation requested successfully
        '400':
          description: Missing required fields

  /api/validation/submit:
    post:
      summary: Submit validation result
      tags:
        - Validation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidationSubmission'
      responses:
        '200':
          description: Validation result submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  validationId:
                    type: string
                    example: validation_1
                  message:
                    type: string
                    example: Validation result submitted successfully
        '400':
          description: Missing required fields

  /api/validation/{agentId}/score:
    get:
      summary: Get validation score
      tags:
        - Validation
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: Validation score
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  validationScore:
                    $ref: '#/components/schemas/ValidationScore'
        '404':
          description: No validation data found

  /api/validation/{agentId}/confidence:
    get:
      summary: Get validation confidence
      tags:
        - Validation
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            type: string
          description: Agent ID
          example: agent_1
      responses:
        '200':
          description: Validation confidence
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  agentId:
                    type: string
                    example: agent_1
                  confidence:
                    type: integer
                    example: 100
                    description: Confidence score (0-100)
                  validated:
                    type: boolean
                    example: true

components:
  schemas:
    AgentRegistration:
      type: object
      required:
        - name
        - description
        - capabilities
      properties:
        name:
          type: string
          example: Weather Bot
          description: Agent name
        description:
          type: string
          example: Provides real-time weather data
          description: Agent description
        capabilities:
          type: array
          items:
            type: string
          example: ['weather', 'forecast', 'alerts']
          description: Agent capabilities
        serviceUrl:
          type: string
          example: http://localhost:3001
          description: Service endpoint URL
        price:
          type: number
          format: float
          example: 0.01
          description: Service price
        currency:
          type: string
          example: USDC
          description: Price currency

    AgentMetadata:
      type: object
      properties:
        name:
          type: string
          example: Weather Bot
        description:
          type: string
          example: Provides real-time weather data
        capabilities:
          type: array
          items:
            type: string
          example: ['weather', 'forecast', 'alerts']
        serviceUrl:
          type: string
          example: http://localhost:3001
        price:
          type: number
          format: float
          example: 0.01
        currency:
          type: string
          example: USDC

    FeedbackSubmission:
      type: object
      required:
        - agentId
        - rating
        - comment
      properties:
        agentId:
          type: string
          example: agent_1
          description: Agent ID to rate
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
          description: Rating (1-5 stars)
        comment:
          type: string
          example: Excellent service!
          description: Feedback comment
        paymentProof:
          type: string
          example: '0x402_proof_hash'
          description: Optional x402 payment proof

    ReputationScore:
      type: object
      properties:
        agentId:
          type: string
          example: agent_1
        averageRating:
          type: number
          format: float
          example: 4.67
          description: Average rating (0-5)
        totalReviews:
          type: integer
          example: 3
          description: Total number of reviews
        trustScore:
          type: integer
          example: 93
          description: Trust score (0-100)

    ValidationRequest:
      type: object
      required:
        - agentId
        - validationType
        - description
      properties:
        agentId:
          type: string
          example: agent_1
          description: Agent ID to validate
        validationType:
          type: string
          enum:
            - stake-re-execution
            - zkml-proof
            - tee-oracle
            - trusted-judge
            - multi-sig
          example: stake-re-execution
          description: Type of validation method
        description:
          type: string
          example: Verify weather data accuracy
          description: Validation description
        stake:
          type: integer
          format: int64
          example: 1000000000000000000
          description: Stake amount in wei (optional)

    ValidationSubmission:
      type: object
      required:
        - validationId
        - isValid
        - evidence
      properties:
        validationId:
          type: string
          example: validation_1
          description: Validation ID
        isValid:
          type: boolean
          example: true
          description: Validation result
        evidence:
          type: string
          example: Verified - data matches expected output
          description: Validation evidence

    ValidationScore:
      type: object
      properties:
        agentId:
          type: string
          example: agent_1
        totalValidations:
          type: integer
          example: 1
          description: Total validations
        passedValidations:
          type: integer
          example: 1
          description: Passed validations
        validationScore:
          type: integer
          example: 100
          description: Validation score (0-100)

    Error:
      type: object
      properties:
        error:
          type: string
          example: Error message
          description: Error description
